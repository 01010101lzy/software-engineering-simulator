---
title: 测试报告
---

> Talk is cheap, Just read the code.
> 
> 空谈误国，代码兴邦。如果您对 C# 和 NUnit 框架有所了解，建议您将 `Assets/Test` 中的测试代码和本文对照查看。

# 测试平台

单元测试、集成测试、部分验收测试：Travis CI 持续集成测试平台，Linux 系统。

验收测试：Surface Pro 4 (Intel i5-6300U, Intel HD Graphics 620)。

# 单元测试

所有单元测试均已通过。具体的测试结果可以在 <https://travis-ci.com/01010101lzy/software-engineering-simulator/> 查看。

下面列出了所有的单元测试内容。

## `SESim.Models.Employee`

测试对象代码：`Assets/lib/models/Employee.cs`。

测试代码： `Assets/Tests/Models/EmployeeTest.cs`。

### `EmployeeEfficiencyTest`

员工的效率应当符合给出的函数定义。

输入与期望输出：

1. 在其他条件不变时，基础倍率与效率成正比。
   1. 输入已知倍率的特性 "java" 计算； 得到正常效率 3。
   2. 输入已知倍率为 0 的特性 "lua" 计算；得到效率为 0。
   3. 输入未知倍率的特性 "javascript" 计算；得到效率为 0。
2. 在工作时间变化时，效率先升高再降低。
   1. 输入工作时间为 0（0 h）；效率为最高效率的一半。
   2. 输入工作时间为 90（0.3 h）；效率为最高效率。
   3. 输入工作时间为 600（2 h）；效率为最高效率。
   4. 输入工作时间为 1200（4 h）；效率为最高效率的一半。
   5. 输入工作时间为 1800（6 h）；效率为 0。
3. 工作效率随健康降低而降低。
   1. 输入健康为 0.5；效率降为一半。
   2. 输入健康为 0；效率为 0.
4. 工作效率随压力先升高再降低。
   1. 输入压力为 0；效率略低于基准效率。
   2. 输入压力为 0.35；效率高于基准效率。
   3. 输入压力为 1；效率低于基准效率。

说明：

- 工作时间、健康和压力值都是程序内部计算生成的数值，不会出现输入错误数值的情况。

## `SESim.Models.Company`

测试对象代码：`Assets/lib/models/Company.cs`。

测试代码： `Assets/Tests/Models/CompanyTest.cs`。

### `CompanyUpdateTest`

在工作时间段，公司应当更新其所有接单的进度。

输入与期望输出：

1. 在 `ut = 0` 时刻调用公司更新；公司订单进度无变化。
2. 在 `ut = 2700 (09:00)` 时刻调用公司更新；公司订单进度增加。

### `AddRemoveContractTest`

测试公司可以正常地添加和删除订单。

输入和期望输出：

1. 向公司添加一个新的订单；订单数量增加 1，公司订单列表包含新订单。
2. 从公司删除该订单；订单数量减少 1，公司订单列表不包含新订单。

### `AddRemoveEmployeeTest`

测试公司可以正常地添加和删除员工。

输入和期望输出：

1. 向公司添加一个新的员工；员工数量增加 1，公司员工列表包含新员工。
2. 从公司删除该员工；员工数量减少 1，公司员工列表不包含新员工。

## `SESim.Models.ContractFactory`



# 集成测试



# 系统测试


# 手动测试

## 基本测试

### 游戏能够正常启动


# 目标系统功能需求

## 辅助类

### 键位分配器

要求：根据不同模块的激活状态自动分配键位触发

大致原理：

1. 任何需要键盘触发的元素需要事先注册到键位分配器上
2. 在运行时每帧判断当前激活的元素/激活的元素向分配器发送自己被激活的消息
3. 调用被激活元素的 callback function 实现键位的触发

### HOCON 配置文件读取器

要求：能够在运行时读取并实例化 Gamedata 目录内 Hocon 格式的配置文件。（Hocon -> Dictionary 的转化有现成的库可以做，现在至少要让每一个需要运行时读取的配置文件可以被从 dictionary 实例化）

### 等宽终端辅助工具

要求：可以辅助建立等宽字体的（伪）命令行终端，详细列举如下：

- [x] 终端大小判断
- [x] 进度条生成
- [ ] 判断字符宽度（CJK dual-width vs. monospace，以后界面有中文之类的情况可能要用到）
- [ ] 记录文件格式化器（最好可以像 Linux 开机的那样……嘛这算是痴人说梦了）
- [ ] 终端字符渲染（定宽行、从上向下滚动直至溢出）
- [ ] 想起来再补充

## 读取配置

用例：

- 读取配置和设置

### 读取配置和设置

输入：N/A  
系统响应：将配置文件夹中的配置文件和设置文件读取进内存，并赋值给游戏内的相应对象。  
输出：显示“正在加载”  
前置条件：游戏启动  
后置条件：进入菜单界面  

活动步骤：

1. 玩家打开游戏。
2. 游戏显示“正在加载”（同时扫描配置文件夹，并读取文件）。
3. 玩家被导航至主菜单。

异常处理：

- 配置文件格式有误或损坏，该配置文件被自动忽略，相关错误被记录并提示。
- 设置文件有误或损坏，错误的值被置为默认值，相关错误被记录并提示。

注：配置文件使用的是 HOCON 格式，因此需要编写从其句法分析后的格式转换为各配置类的转换器。

## 选择主菜单选项

用例：

- 开始新游戏
- 加载存档
- 选择设置
- 查看制作人员表
- 退出

### 开始新游戏

输入：新游戏参数  
系统响应：创建新游戏，并进入游戏界面  
输出：游戏内界面  
前置条件：加载完成并进入主菜单  
后置条件：进入游戏

活动步骤：

1. 玩家点击“新游戏”按钮。
2. 程序显示创建游戏界面。
3. 玩家输入游戏参数。
4. 玩家进入游戏。

异常处理：

- 信息不全或错误，程序给出错误信息，玩家无法创建游戏。

### 加载存档

输入：被选择的存档  
系统响应：进入所选存档的游戏  
输出：游戏内界面  
前置条件：加载完成并进入主菜单  
后置条件：进入游戏

活动步骤：

1. 玩家点击“加载存档”按钮。
2. 程序展示存档选择界面。
3. 玩家选择存档。
4. 玩家进入游戏。

异常处理：

- 存档文件错误或损坏，程序给出错误信息，玩家无法进入游戏。

### 查看设置

输入：N/A  
系统响应：显示设置菜单  
输出：设置菜单  
前置条件：加载完成并进入主菜单  
后置条件：进入设置界面

活动步骤：

4. 玩家点击“设置”按钮。
5. 程序展示设置界面。

异常处理：

N/A

### 查看制作人员表

输入：N/A  
系统响应：展示制作人员表  
输出：N/A  
前置条件：加载完成并进入主菜单  
后置条件：N/A

活动步骤：

1. 玩家点击“制作人员表”按钮。
2. 程序展示制作人员表和开源协议。
3. 玩家可以在中途或展示完毕后点击退出。

异常处理：

N/A

### 退出游戏

输入：N/A  
系统响应：退出游戏  
输出：N/A  
前置条件：N/A  
后置条件：N/A

活动步骤：

1. 玩家点击“退出”按钮或点击窗体关闭按钮。
2. 游戏退出。

异常处理：

- 如果该项功能在游戏内调用，程序会在存储完当前存档后退出。

## 读写设置项

用例：

- 显示设置
- 应用并存储设置

### 显示设置

输入：N/A  
系统响应：显示设置项列表  
输出：设置项列表  
前置条件：玩家打开设置界面  
后置条件：N/A

活动步骤：

1. 系统显示当前设置项与其值。

异常处理：

N/A

### 应用并存储设置

输入：玩家修改后的设置项  
系统响应：应用并存储设置  
输出：存储成功并返回  
前置条件：玩家在设置界面内  
后置条件：设置存储成功并应用到游戏内

活动步骤：

1. 玩家修改设置。
2. 玩家点击“确定”。
3. 系统应用设置并退出设置界面。

异常处理：

- 玩家输入的数值有误，系统拒绝存储并提示玩家修改错误。

## 游戏内部运行

用例：

- 每帧固定更新
- 玩家招聘员工
- 玩家解雇员工
- 玩家接单
- _玩家修改任务参数？_
- 玩家完成任务
- 玩家放弃任务
- _玩家与员工互动？_
- _玩家调整公司决策？_
- 玩家贷款
- _玩家还款？_
- 玩家调整时间加速倍率
- 随机事件发生

标有“？”的用例为还未确定的特性。

注：
- 本需求下的用例全部带有前置条件“游戏中”，在以下的叙述中将被省略。
- 标有 `（时间暂停）` 的活动步骤在开始执行时游戏时间将会被暂停，直至 `（时间恢复）` 标志的步骤或活动结束为止。

### 每帧固定更新

输入：N/A  
系统响应：更新游戏物体数据  
输出：显示数据更新  

活动步骤：

1. 根据当前帧对应的游戏时间、员工基础效率等信息计算员工的当前效率
2. 根据员工效率和项目信息计算员工在一帧内完成的工作量
3. 根据工作量更新项目信息
4. 更新员工的熟练度、基础效率、压力值、健康值等信息
5. 更新公司的声望、资金、员工总状态等信息
6. 更新可招聘人员、可接单列表等信息
7. 进行随机事件的条件判断和触发
8. 更新办公室环境视图中员工的位置和动作

异常处理：

- 公司没有足够资产，公司破产、游戏失败

注：每帧固定更新不需要用户触发，在更新中系统根据时间加速倍率和帧时间计算当前帧中游戏物体的各个参数值，并更新游戏界面上展示的结果。

### 玩家招聘员工

输入：员工列表中被招聘的员工  
系统响应：将员工从可招聘列表移至员工列表  
输出：员工被加入员工列表

活动步骤：

1. 玩家点击招聘（时间暂停）
2. 展示所有可以招的人的列表
3. 读取玩家选择的员工
4. （游戏时间第二天）将员工加入员工列表
5. 预付给员工 2 个月的薪水（游戏内部规则，暂定）

异常处理：

N/A（玩家只能在有限的列表中选择）

### 玩家解雇员工

输入：玩家选择解聘的员工  
系统响应：员工被员工列表中移动到可招聘列表  
输出：员工从员工列表消失

活动步骤：

1. 玩家从员工列表内选择解雇员工（时间暂停）
2. 玩家确认解雇员工
3. 将员工从员工列表移至可招聘列表
4. 付给员工薪资与离职赔偿

异常处理：

N/A（同上）

### 玩家接单

输入：被接受的任务、玩家选择分配的资源  
系统响应：将任务从可接任务列表移至当前任务列表  
输出：任务被加入当前任务列表

活动步骤：

1. 玩家点击接单（时间暂停）
2. 展示可接任务列表
3. 读取玩家选择的任务
4. 将任务加入当前任务列表
5. 公司增加与任务相符的资金、声望等
6. 玩家为任务分配人员、资金等资源，并安排时间、计划

异常处理：

N/A（同上）

### 玩家修改任务参数

输入：要修改的任务、被修改的参数  
系统响应：任务相关参数被修改  
输出：修改后的任务参数

活动步骤：

1. 玩家选择要修改的任务（时间暂停）
2. 玩家修改任务参数（如人员、计划等）
3. 玩家确认修改
4. 任务相关资源被修改，按照规则设置即时或第二天生效

异常处理：

- 修改计划不合法，在不合法的输入处出现提示，并阻止玩家提交

### 玩家放弃任务

输入：玩家选择放弃的任务  
系统响应：任务被从列表中删除  
输出：任务从列表中消失

活动步骤：

1. 玩家从任务列表内选择放弃任务（时间暂停）
2. 将任务从当前任务列表里删除
3. 公司被扣除与任务相符的违约金、声望等
4. 任务相关人员和资源被释放

异常处理：

N/A（同上上）

### 玩家完成任务

输入：N/A（任务自动完成）  
系统响应：任务被从列表中消失  
输出：任务从列表中消失

活动步骤：

1. 任务从当前任务列表里被删除
2. 公司获得与任务相符的资金、声望等
3. 任务相关人员和资源被释放
4. 玩家收到任务完成的提示（可以有时间暂停或时间加速取消）

异常处理：

N/A（同上）

### 玩家调整公司策略

输入：新的公司策略  
系统响应：公司策略被更改  
输出：公司策略被更改

活动步骤：

1. 玩家选择调整公司策略（时间暂停）
2. 玩家输入新的策略
3. 玩家确定更改
4. 公司策略更改，按设定即时或第二天生效

异常处理：

- 玩家输入不合法，出现错误提示，并阻止玩家提交

### 玩家贷款

输入：玩家选择贷款来源  
系统响应：公司从选择的来源贷到款  
输出：资金增加，定期还款

活动步骤：

1. 玩家选择贷款（时间暂停）
2. 玩家选择贷款来源
3. 玩家确定贷款
4. 公司资金增加，同时定期（每月）向贷款公司支出一定资产还款

异常处理：

- 公司没有足够资金还款，公司破产、游戏失败

### 玩家调整时间加速倍率

输入：新的时间加速倍率  
系统响应：时间流逝速度加快  
输出：新的时间流速

活动步骤：

1. 玩家通过鼠标选择或快捷键调整时间流速
2. 时间流速改变

异常处理：

N/A

注：

- 目前设定时间流速有以下选择：
  - 1x（正常流速，暂定一分钟一天）
  - 2x
  - 4x
  - 8x
  - 16x
  - 32x（待定）

### 随机事件发生

输入：随机事件处置方式  
系统响应：随机事件发生  
输出：随机事件提示、影响

活动步骤：

1. 计算随机事件的触发器，如果发生执行下面步骤
2. 调整时间流速为 1x
3. 按照随机事件触发器定义修改资源情况
4. 向玩家发送随机事件发生的提示，指示发生事件和影响
5. 玩家选择处置事件的方式（如果有）

异常处理：

N/A


